<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Carrito - Panadería Delicia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --rosado: #e91e63;
      --rosado-oscuro: #ad1457;
      --rosado-pastel: #f8bbd0;
    }
    body { font-family: 'Poppins', sans-serif; background-color: #fff5f8; }
    .btn-rosado { background-color: var(--rosado); color: white; font-weight: 600; padding: 0.5rem 1rem; border-radius: 50px; transition: all 0.3s ease; }
    .btn-rosado:hover { background-color: var(--rosado-oscuro); }
    table img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
    h1.fw-bold.text-rosado { color: var(--rosado); margin-bottom: 2rem; text-align: center; }
  </style>
</head>
<body>

  <div class="container py-5">
    <h1 class="fw-bold text-rosado">Carrito de Compras</h1>
    <div id="cart-container"></div>
    <div class="text-end mt-3">
      <h4>Total: S/ <span id="total">0.00</span></h4>
      <button class="btn btn-rosado mt-2" id="checkout-btn">Pagar</button>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Iniciar Sesión</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="loginForm">
            <div class="mb-3">
              <label class="form-label">Usuario</label>
              <input type="text" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Contraseña</label>
              <input type="password" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-rosado w-100">Ingresar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Tipo de Pago</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Seleccione su método de pago:</p>
          <button class="btn btn-rosado w-100 mb-2" onclick="pay('Tarjeta')">Tarjeta</button>
          <button class="btn btn-rosado w-100" onclick="pay('Yape')">Yape</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Cargar carrito desde localStorage
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function renderCart() {
      if(cart.length === 0) {
        document.getElementById('cart-container').innerHTML = '<p class="text-center">El carrito está vacío.</p>';
        document.getElementById('total').innerText = '0.00';
        return;
      }

      let html = `<table class="table table-bordered align-middle text-center">
                    <thead class="table-light">
                      <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                        <th>Eliminar</th>
                      </tr>
                    </thead>
                    <tbody>`;
      let total = 0;
      cart.forEach((item, index) => {
        const subtotal = item.price * item.quantity;
        total += subtotal;
        html += `<tr>
                  <td><img src="${item.img}" alt="${item.name}"> <br> ${item.name}</td>
                  <td>S/ ${item.price.toFixed(2)}</td>
                  <td><input type="number" min="1" value="${item.quantity}" class="form-control quantity-input" data-index="${index}"></td>
                  <td>S/ ${subtotal.toFixed(2)}</td>
                  <td><button class="btn btn-danger btn-sm remove-btn" data-index="${index}"><i class="fa fa-trash"></i></button></td>
                 </tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById('cart-container').innerHTML = html;
      document.getElementById('total').innerText = total.toFixed(2);

      // Eventos de cantidad
      document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', e => {
          const idx = e.target.dataset.index;
          const val = parseInt(e.target.value);
          if(val < 1) { e.target.value = cart[idx].quantity; return; }
          cart[idx].quantity = val;
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        });
      });

      // Eventos eliminar
      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = btn.dataset.index;
          cart.splice(idx, 1);
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        });
      });
    }

    renderCart();

    // Checkout
    document.getElementById('checkout-btn').addEventListener('click', () => {
      if(cart.length === 0) { alert('El carrito está vacío'); return; }
      const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
      loginModal.show();
    });

    // Login Form
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
      loginModal.hide();
      const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
      paymentModal.show();
    });

    // Pago
    function pay(method) {
      const paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
      paymentModal.hide();
      alert(`¡Pago realizado con ${method}!\nGracias por su compra.`);
      cart = [];
      localStorage.removeItem('cart');
      renderCart();
    }
  </script>

</body>
</html>
